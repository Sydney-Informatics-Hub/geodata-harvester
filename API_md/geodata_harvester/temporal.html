<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Geodata-Harvester – temporal</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Geodata-Harvester</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../py_dataharvester.html">
 <span class="menu-text">Python</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../R_dataharvester.html">
 <span class="menu-text">R-Package</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../contributing.html">
 <span class="menu-text">Contributing</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../events.html">
 <span class="menu-text">Events</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#module-geodata_harvester.temporal" id="toc-module-geodata_harvester.temporal" class="nav-link active" data-scroll-target="#module-geodata_harvester.temporal">Module geodata_harvester.temporal</a>
  <ul class="collapse">
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions">Functions</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="module-geodata_harvester.temporal" class="level1">
<h1>Module geodata_harvester.temporal</h1>
<p>Utility functions for for temporal processing.</p>
<p>–Function List, in order of appearence–</p>
<p>combine_rasters_temporal: Concatenates files by time returns xarray. aggregate_temporal: Aggregates xarrays by specified function and time period.</p>
<section id="functions" class="level2">
<h2 class="anchored" data-anchor-id="functions">Functions</h2>
<dl>
<dt><code>aggregate_temporal(xdr, period='yearly', agg=['mean'], outfile='temporal_agg', buffer=None)</code></dt>
<dd>
<p>Make a data aggregation (mean, median, sum, etc) through time on an xarray. Expects xarray coordinates to be x, y, time. Saves every aggregation for every time period as its own tif file.</p>
<p>Example: file_list = [‘../data/mvp_daily_rain_silo/daily_rain_2017_cropped.tif’, ‘../data/mvp_daily_rain_silo/daily_rain_2018_cropped.tif’]</p>
<p>xdr = combine_rasters_temporal(file_list, channel_name=‘band’,attribute_name=‘long_name’)</p>
<p>outfname_list, agg_list = aggregate_temporal( xdr,period=100,agg=[‘mean’,‘sum’],outfile=‘temporal_agg’)</p>
<h2 id="parameters" class="anchored">Parameters</h2>
<p>xdr : xarray object of x,y,time period : string or int. Time period to perform aggregation, ‘yearly’, ‘monthly’, or number of periods to aggregate over. agg: list of strings. Choice of aggregation methods to apply of [‘mean’,‘median’,‘sum’,‘perc95’,‘perc5’] outfile : string. Prefix of output file name. buffer: integer time period in same units as period to buffer into the future.</p>
<h2 id="returns" class="anchored">Returns</h2>
<p>outfname_list : list of strings of output file names agg_list : list of strings of aggregation methods</p>
</dd>
<dt><code>combine_rasters_temporal(file_list, channel_name='band', attribute_name='long_name')</code></dt>
<dd>
<p>Combines multiple tif files into single xarray object. Assumes files are in temporal order, and additional channels contain sequential time step data. Also assumes files are of the same shape (x,y,t).</p>
<p>Example: file_list = [‘../data/mvp_daily_rain_silo/daily_rain_2017_cropped.tif’, ‘../data/mvp_daily_rain_silo/daily_rain_2018_cropped.tif’]</p>
<p>xdr = combine_rasters_temporal(file_list, channel_name=‘band’,attribute_name=‘long_name’)</p>
<h2 id="parameters-1" class="anchored">Parameters</h2>
<p>file_list : list of filename strings in date order to concatenate. Expected to be of the form “x,y” or “x,y,z1” channel_name : string of coordinate dimension to concatentate (band, time, etc). Check options with rioxarray.open_rasterio(‘filename’).coords attribute_name : string name of rioxarray attribute holding a time/date label. Check with rioxarray.open_rasterio(‘filename’).attrs</p>
<h2 id="returns-1" class="anchored">Returns</h2>
<p>xdr : xarray object of x,y,time, with approriate metadata.</p>
</dd>
<dt><code>group_by_custom_periods(xdr, periods:&nbsp;int, agg_range:&nbsp;int)</code></dt>
<dd>
<p>NOTE: NOT ALL IMPLEMENTED!!! Specifcally multiband data. But I don’t think we want to deal with that, as it is already accounted for previously? Maybe.</p>
<p>Aggregates over multiple files but keeps channels independently. Results are written to new tif files.</p>
<p>This function should</p>
<p>dates of the from “yyyy-mm-dd” rolling mean</p>
<p>Unit of measurment you are working in seconds, daily, monthly, yearly (or integers) Time steps of channels (e.g.&nbsp;12xmonthly) time steps of files (each file represents X length of time) time steps of aggregation (e.g.&nbsp;average monthly) time steps of</p>
<p>Aggregrates over multiple files and over all channels and writes results to new tif file(s).</p>
<p>Step 1: combine files (assumes consistent times and start finish points) Step 2: roll data into outtime chunks Step 3: perform aggregation on chunks</p>
<p>e.g.&nbsp;aggregate daily rainfall data for each month (for the duration of the files.) e.g.&nbsp;aggregate monthly temperature data over a year (for the duration of the files.)</p>
<p>e.g.&nbsp;aggregate common months over multiple years, average rainfall in July from 2015 to 2020</p>
<p>Takes a stream of temporal data in a particular time increment and converts to a new time-increment by averaging.</p>
</dd>
<dt><code>temporal_crop(xdr, start_time, end_time)</code></dt>
<dd>
<p>Cuts an xarray object by start and end times.</p>
<h2 id="parameters-2" class="anchored">Parameters</h2>
<p>xdr : xarray object of x,y,time start_time : string time in ‘yyyy-mm-dd’ format. end_time : string time in ‘yyyy-mm-dd’ format.</p>
<h2 id="returns-2" class="anchored">Returns</h2>
<p>xdr_crop : xarray object of x,y,time, with approriate metadata.</p>
</dd>
</dl>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>